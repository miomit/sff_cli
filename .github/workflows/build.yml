name: Publish utility on release

on:
  push:
    branches:
      - main
  release:
    types: [published]

permissions:
  contents: write

jobs:
    build:
        name: Build binaries
        runs-on: ubuntu-latest
        steps:

          - uses: actions/checkout@v4
          - uses: dart-lang/setup-dart@v1

          - name: Git submodule
            run: git submodule init && git submodule update

          - name: Install dependencies
            run: dart pub get

          - name: 'ðŸ“„ Checkout'
            uses: actions/checkout@v3

          - name: 'ðŸ“¦ Package windows x64'
            run: |
                dart compile exe bin/sff_cli.dart -o sff
                gh release upload ${{github.event.release.tag_name}} sff
            env:
              GITHUB_TOKEN: ${{ github.TOKEN }}
            shell: bash